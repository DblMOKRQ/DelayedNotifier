# Delayed Notifier (–°–µ—Ä–≤–∏—Å –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)

–ü—Ä–æ—Å—Ç–æ–π, –Ω–æ –Ω–∞–¥–µ–∂–Ω—ã–π —Å–µ—Ä–≤–∏—Å –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –Ω–∞ Go. –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Telegram –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è —Å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–æ–π –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –º–µ—Ö–∞–Ω–∏–∑–º–æ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–æ–∫ –≤ —Å–ª—É—á–∞–µ —Å–±–æ—è.

## ‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

-   **–û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞**: –°–æ–∑–¥–∞–≤–∞–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ –ª—é–±—É—é —É–∫–∞–∑–∞–Ω–Ω—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –≤ –±—É–¥—É—â–µ–º.
-   **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram**: –ü—Ä–æ—Å—Ç–∞—è –∏ –±—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º Telegram.
-   **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ RabbitMQ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –±—Ä–æ–∫–µ—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –Ω–∏ –æ–¥–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–µ –±—É–¥–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω–æ.
-   **–ú–µ—Ö–∞–Ω–∏–∑–º –ø–æ–≤—Ç–æ—Ä–æ–≤**: –í —Å–ª—É—á–∞–µ –Ω–µ—É–¥–∞—á–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç –ø–æ–ø—ã—Ç–∫—É —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π.
-   **REST API**: –£–¥–æ–±–Ω—ã–π HTTP-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ, –ø–æ–ª—É—á–µ–Ω–∏–µ, –æ—Ç–º–µ–Ω–∞).
-   **–ü–ª–∞–≤–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã (Graceful Shutdown)**: –°–µ—Ä–≤–∏—Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É —Ç–µ–∫—É—â–∏—Ö –∑–∞–¥–∞—á –ø–µ—Ä–µ–¥ –≤—ã–∫–ª—é—á–µ–Ω–∏–µ–º.
-   **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `zap` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
-   **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ YAML**: –õ–µ–≥–∫–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥ –ª—é–±–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ.
-   **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î**: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–µ—Ç—Å—è –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ.

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

-   **–Ø–∑—ã–∫**: [Go](https://golang.org/)
-   **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: [PostgreSQL](https://www.postgresql.org/)
-   **–ë—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π**: [RabbitMQ](https://www.rabbitmq.com/) (—Å –ø–ª–∞–≥–∏–Ω–æ–º `rabbitmq_delayed_message_exchange`)
-   **HTTP –†–æ—É—Ç–µ—Ä**: [Gin](https://github.com/gin-gonic/gin) (—á–µ—Ä–µ–∑ –∫–∞—Å—Ç–æ–º–Ω—É—é –æ–±–µ—Ä—Ç–∫—É `wb-go/wbf/ginext`)
-   **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: `uber-go/zap`
-   **–ú–∏–≥—Ä–∞—Ü–∏–∏**: `golang-migrate`

## üöÄ –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

### –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —É—Å–ª–æ–≤–∏—è

-   [Go](https://golang.org/doc/install) 

### –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

1.  **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
    ```bash
    git clone https://github.com/DblMOKRQ/DelayedNotifier.git
    cd DelayedNotifier
    ```

2.  **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
    –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –µ–≥–æ:
    ```bash
    cp config/config.example.yaml config/config.yaml
    ```
    –û—Ç–∫—Ä–æ–π—Ç–µ `config/config.yaml` –∏ —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ:
    -   `bot_token`: API-—Ç–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ Telegram-–±–æ—Ç–∞.
    -   `master_dsn`: –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL.
    -   `amqp_server_url`: –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ RabbitMQ.
3.  **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
    ```bash
    go run ./cmd/main.go
    ```
    –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É, —É–∫–∞–∑–∞–Ω–Ω–æ–º –≤ `config.yaml` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `:8080`).

## ‚öôÔ∏è API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### 1. –°–æ–∑–¥–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

-   **`POST /notify`**

    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.

    **–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (JSON):**
    ```json
    {
      "channel": "telegram",
      "send_at": "2025-12-10T15:00:00Z",
      "recipient": "–í–ê–®_TELEGRAM_CHAT_ID",
      "message": "–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ!"
    }
    ```

    **–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (200 OK):**
    ```json
    {
      "id": "a1b2c3d4-e5f6-7890-1234-567890abcdef"
    }
    ```

### 2. –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

-   **`GET /notify/:id`**

    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏ –ø–æ –µ–≥–æ ID.

    **–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
    ```bash
    curl http://localhost:8080/notify/a1b2c3d4-e5f6-7890-1234-567890abcdef
    ```

    **–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (200 OK):**
    ```json
    {
      "id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
      "channel": "telegram",
      "status": "PENDING",
      "send_at": "2025-12-10T15:00:00Z",
      "recipient": "123456789",
      "message": "–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ!",
      "retry_attempts": 0,
      "next_send_at": "2025-12-10T15:00:00Z"
    }
    ```

### 3. –û—Ç–º–µ–Ω–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

-   **`DELETE /notify/:id`**

    –û—Ç–º–µ–Ω—è–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ. –°—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `CANCELLED`, –∏ –æ–Ω–æ –Ω–µ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ.

    **–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
    ```bash
    curl -X DELETE http://localhost:8080/notify/a1b2c3d4-e5f6-7890-1234-567890abcdef
    ```

    **–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (204 No Content).**

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ cmd/main.go          # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ config/              # –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ rabbit/          # –õ–æ–≥–∏–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å RabbitMQ (consumer, publisher)
‚îÇ   ‚îú‚îÄ‚îÄ repository/      # –°–ª–æ–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö (PostgreSQL)
‚îÇ   ‚îú‚îÄ‚îÄ router/          # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTTP-—Ä–æ—É—Ç–µ—Ä–∞ –∏ middleware
‚îÇ   ‚îú‚îÄ‚îÄ sender/          # –õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (Telegram)
‚îÇ   ‚îî‚îÄ‚îÄ service/         # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ migrations/          # SQL-—Ñ–∞–π–ª—ã –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ pkg/                 # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞–∫–µ—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ª–æ–≥–≥–µ—Ä)
‚îî‚îÄ‚îÄ go.mod
```

